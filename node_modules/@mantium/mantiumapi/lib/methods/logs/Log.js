"use strict";

var config = require('../../config/config');

var msg = require('../../config/error-message');

var fetch = require('../fetch');

var utils = require('../utility');

module.exports = function (headers, opt) {
  if (!headers.api_key) throw new Error(msg.errorMessages().access_token_missing);
  if (['GET', 'PATCH', 'DELETE'].includes(opt.method) && utils.isNil(opt.id) && opt.io_type === 'item') throw new Error(msg.errorMessages().id_missing);
  var id = utils.isNotNil(opt.id) ? opt.id : '';
  var options = {
    method: opt.method,
    url: config.logsURL(opt.isIdURL).concat('/', id, utils.objToQueryStr(opt.queryParam)),
    headers: headers.getHeaders()
  };
  return fetch(options);
};